\cleartooddpage[\thispagestyle{empty}]
\chapter{Hemodynamic Flow Vortex Identification}\label{CHAPTER2}

Recent attention has focused on assessing hemodynamic characteristics as disturbed aneurysmal hemodynamics is known to have an impact on the origin and national history of IAs \cite{weir2002unruptured,brisman2006cerebral}. From a clinical perspective, phase-contrast magnetic resonance imaging (PC-MRI) or Phase-contrast magnetic resonance angiography (PC-MRA) has been used to assess flow characteristics in the vasculature \textit{in-vivo} \cite{benndorf1996intraaneurysmal,meckel2008vivo}. Yet, determining flow details in and around IAs has proven difficult with PC-MRI/PC-MRA. The individual protons in complex and disturbed aneurismal flow has incoherent velocites (at the sub-grid level) and these specific characteristics cannot be resolved by a typical "averaged" velocity measurement from a relatively large resolution cell (\textit{at 1-mm scale}). The consequence of this sub-grid limitation, clinical hemodynamic flow measurements may be impacted by errors and potential flow artifacts which adversely affect the accuracy of PC-MRI/PC-MRA results. In parallel to research efforts of assessing MR flow imaging in and around IAs to determine rupture characteristics, blood flow simulated from "patient-specific" computational fluid dynamics (CFD) simulations \cite{steinman2002image} have also garnered interest by the clinical and research community \cite{xiang2011hemodynamic,cebral2011association}. CFD simulation data has an initial advantage over MRI derived data in that a high degree of control of both desired data resolution, as well as data quality (lack of imaging errors and flow artifacts) can be maintained. The development of novel flow measurement techniques can be initially created and tested on data free from errors which may confound initial findings.

Assessment of hemodynamic conditions from CFD simulations has brought about a number of potential parameters that correlate to IA rupture risk: wall shear stress \cite{baek2009flow}, oscillatory shear index \cite{steinman2003image}, flow impingement \cite{cebral2011association}, and flow stability \cite{byrne2014quantifying}. As mentioned in the focus of flow stability, Bryne et al. \cite{byrne2014quantifying} found that aneurismal flow that aligns with IA rupture is closely correlated with flow spatial complexity and temporal stability. Yet this methodology only relies on the assessment of the centroid-most region of vortex patterns (vortex core), giving less insight on the broader structural changes to vortices. Expanding upon the idea of vortex analysis to identify, and quantify changes to, the broader structure of vortices may give additional insight into flow characteristics that can be linked to IA rupture potential.

In an initial study, the development of an alternative technique that expanded upon vortex core analysis was investigated to characterize the presence, destruction and motion of vortices within an IA \cite{sunderland2016vortex}. This image processing algorithm expanded upon two established vortex identification methods, the \textit{Q}-criterion \cite{hunt1988eddies} and $\lambda_2$ \cite{jeong1995identification} methods, to identify and assess the broader aspects of vortices as opposed to solely identifying the vortex core. Subsequent studies investigated the use of a vortex identification methodology based on the Shannon's entropy (CITATION NEEDED) as an alternative identification metric not wholly reliant upon vortex core identification. 

Due to the differences between traditional CFD data resolution (high) and MRI derived flow data (lower resolution), the identification methods were based on velocity data on a rectilinear grid, and the susceptibility of changes to vortex identification outcomes were tested under a range of grid resolutions. Additionally, variations to methodological outputs were tested under a range of chosen threshold values (dependent on the method and will be explained in Section NEED THE SECTION). The vulnerability of a methodology to significant changes in outcomes with minimal changes to methodological threshold values could in theory result in variations to research findings if differing thresholds were to be applied to a wide array of studies. Toward this end, the primary focus of this work was to explore analyzing the spatio-temporal characteristics of hemodynamic vortices as a possible means to compliment future assessment of IA rupture potential.  

\section{Materials and Methods}\label{CHAPTER2_SECTION1}
\subsection{Modeling of "Patient-specific" Vasculature}\label{CHAPTER2_SECTION1_SUBSECTION1}

In the initial study 10 cases of IAs were abritraily selected from an internal database: five cases with a single terminal aneurysm, and five cases with a single sidewall aneurysm. Models were either located within the internal carotid artery or the basilar artery. A commercially available image segmentation package (Mimics Innovation Suite, version 17, Materialise Inc. Leuven, Belgium) was used to reconstruct the vascular surface from digital subtraction angiography (DSA) scans. For all cases, the longest possible upstream section proximal to the aneurysm, was left intact to maintain as much of the patient vessel as possible. Surface irregularities were removed using the 3-matic software (Version 9, Materialize Inc., Leuven, Belgium) as well as a $1^{st}$ order Laplacian smoothing filter to reduce irregularities while preserving vascular geometry. Cylindrical flow extensions (6 times the inlet vessel diameter) were added to each model using the open-source Vascular Modeling Toolkit (VMTK) software (version 1.2). The addition of vessel extensions help reduce the effects of inlet, plug-flow flow on hemodynamic characteristics \cite{poethke2009cerebral}.

\subsection{Mesh Generation}\label{CHAPTER2_SECTION1_SUBSECTION2}
Processed vascular surface structures were converted into an unstructured, 3D, tetrahedralized volumetric mesh using an open-source mesh generator, Tetgen (version 1.4.2) \cite{si20113d}. The mesh generation process was done by an in-house Python script derived from the VMTK program. Approximatley, 1 million computing cells were used per case, with the average mesh size as 0.0022-mm$^{3}$.

\subsection{CFD Simulation}\label{CHAPTER2_SECTION1_SUBSECTION3}
To compute fluid velocity waveforms in and around the IA, the time-dependent incompressible, 3D Navier-Stokes equations for the meshed vessel geometry was solved using two CFD solvers: a commercial CFD solved (version 14.0, ANSYS-FLUENT Inc., Lebanon, NH) and a research prototype CFD solver (version 4.0, Siemens Medical Solution Inc., IL). Details on the Navier-Stokes equation can be found in the Appendix.  In the ANSYS-FLUENT solver, the pressure-velocity coupling was obtained using the SIMPLEC algorithm \cite{versteeg2007introduction}. The explicit time-marching second-order scheme with a time step of $1\times 10^-3$ second (1000 steps per cardiac cycle) was used for computations.

As the Siemens research CFD solver is still under development, limited information on its methods for solving the Navier-Stokes equation will be discussed in this thesis. IA models were defined by water-tight 3D surface triangles were automatically discretized with cubical voxels. A Lattice-Boltzmann Mehod (LBM) solver was then used to chose adaptievly choose the solver time-step, and varried from $1\times 10^-3$ to $2\times 10^-3$. A Siemens Leonardo workstation equipped with a dual quad-core CPU and 8 GB of memory was used to perform CFD simulations. Of note, the exact same vessel geometries (STL files) were used to generate the volumetric meshes (for the ANSYS-FLUENT solver) and voxel discretization (for the LBM solver). The final velocity results obtained from the LBM method were resampled to form velocity data onto a rectilinear grid whose voxel size varried from 0.18 to 0.25 mm.

In both solvers, vessels walls were assumed rigid with a no-slip boundary. Blood was considered an incompressible and Newtonian fluid with a dynamic viscosity of 0.004 kg/m-s and a mass density of 1050 kg/m$^3$. A zero-pressure condition was used for all vessel outlets. For inlet flow rates, two pulsatile waveforms at a rate of 60 bpm were derived from magnetic resonance measurements and were taken from Gwilliam et al. \cite{gwilliam2009mr} as patient-specific flow waveforms were not available. Each case had its inlet waveform scaled according to their inlet cross-sectional area, standardizing their mean volumetric flow rate to either 280mL/min for ICA cases or 180mL/min for BAs. This choice of volumetric flow rate(s) were based on measured physiological flow rates available in MR literature \cite{enzmann1994blood,zhao2007regional}. Four (4) cardiac cycles were simulated per case at 20 data points per cardiac cycle with only the final cardiac cycle saves as a means to reduce initial transient flow conditions.  

\subsection{Aneurysm Extraction and Voxelization of Aneurismal Velocity Data}
A published method \cite{jiang2013interactive} was used to semi-automatically isolate and extract the IA sac. The isolated IA sac was sealed at the IA opening (ostium) and converted to a binary mask that is spatially-registered with the volumetric velocity data. The mask allows the analysis of only the intra-aneurysmal velocity data. TO verify intra-rater reliability of proper sectioning of IA masks, 2 separate users sectioned the IAS and Bland-Altman plots were performed on the resultant mask volumes and ostium areas to determine the similarity between chosen masks. Once no significant differences were ensured between sectioned masks, one user was chosen at random and all resultant masks from that user were implemented in the rest of the study. 

\subsection{Vortex Core Extraction and Analysis}\label{CHAPTER2_SECTION1_SUBSECTION4}
All computational methods for identification and extraction of vortices and spatio-temporal analysis of said vortices were performed using in-house scipts (C++ and Python) that were derived form the open-source VTK/VMTK software package.


 


This flow assessment was performed through the analysis of vortex critical point (core) lines and it was concluded that "ruptured aneurysms had more complex and more unstable flow patterns than un-ruptured aneurysms." In their work, Bryne used proper orthogonal decomposition \cite{} of time-resolved velocities were used to characterize temporal flow stability. As a brief explanation, vortex core lines, identifying the center-most region of vortex pattern, were identified by the use of a co-linearlity conditions between flow instantaneous vorticity $\vec{\omega}$ and velocity $\vec{v}$ vectors.

\begin{equation}
\begin{aligned}
\vec{\omega} \times \vec{v} = 0 \\
\vec{\omega} = \nabla \times \vec{v}
\end{aligned}
\label{CHAPTER2_vortex_core_line}
\end{equation}

To identify the centroid region of vortices, the eigenvalues of the velocity gradient tensor was calculated. In the event of a pair of complex conjugate eigenvalues was identified, the vorticity vector $\vec{\omega}$ as calculated and tested against the velocity vector to assess whether Equation \ref{CHAPTER2_vortex_core_line} was satisfied. From an identified element, the velocity component in the direction of vorticity vector was subtracted form the velocity vector (reduced velocities). Element faces that had a point where the reduced velocity is zero was marked, and if two or more faces of an element had a zero reduced velocity, a vortex core line passes through the element. 

Vortex core line analysis 



\begin{equation}
\begin{aligned}
\nabla \vec{u} & = S + \Omega \\
  			   & S = \frac{1}{2}\left[(\nabla \vec{u}) + (\nabla \vec{u})^T\right] \\
  			   & \Omega = \left[\frac{1}{2}(\nabla \vec{u}) - (\nabla \vec{u}^T)\right]
\end{aligned}
 \label{CHAPTER2_velocity_gradient_tensor}
\end{equation}

Where $\nabla\vec{u}$ is the calculation of the velocity gradient: S as the rate-of-strain tensor and $\Omega$ as the vorticity tensor.

Hunt, Wray and Moin \cite{hunt1988eddies} defined a vortex as the spatial region of flow where  the Euclidean norm of the vorticity tensor dominates.
\begin{equation}
Q = \frac{1}{2}\left[|\Omega|^2 - |S|^2\right] > 0
\label{CHAPTER2_Q}
\end{equation}

Jeong and Hussain identified the vortices as:
\begin{equation}
\lambda_2 = (S^2 + \Omega^2) < 0
\label{CHAPTER2_lambda2}
\end{equation}
where $\lambda_2{A}$ identifies a vortex when the second intermediate eigenvalue of the 3 x 3 tensor \textit{A} is symmetric (all three eigenvalues are real). 

In our original study, the normalized Q and $\lambda_2$ values were tested to identify vortices within IAs.

\begin{equation}
\begin{aligned}
&Q(x,t) = \frac{Q(x,t)}{|\vec{u}(x,t)|^2} \\
&\lambda_2 (x,t) = \frac{\lambda_2 (x,t)}{|\vec{u}(x,t)|^2}
\end{aligned}
\label{CHAPTER2_normalized_Q_lambda2}
\end{equation}



Eirmod malorum vis ei. Choro euismod incorrupte in vim, ludus ornatus vis ex. 
Hinc wisi impedit eum no, vocent definiebas referrentur in quo. Sanctus 
vulputate repudiandae usu ut. In prima quaeque diceret pri. Enim labores 
contentiones eos at, duo altera denique nominavi ea, eos inani nominavi 
consectetuer at.

Liber liberavisse nec at, movet albucius principes has at. Ea sed persius 
accusam, clita sententiae adversarium ne sed. Usu no graecis theophrastus 
delicatissimi, sint aliquam an eam. Mei elit mnesarchum dissentias te, in 
essent laboramus per. Affert mucius quidam mel ex, per dicam insolens ad.

\begin{figure}[htb]
  \begin{center}
    \subfigure[Generic]{
      \includegraphics[height=0.30\textheight]{NearestNeighborsHistogram}
      \label{CHAPTER2_FIG01a}
    }%
    \subfigure[200 bins]{
      \includegraphics[height=0.30\textheight]{NearestNeighborsHistogram200}
      \label{CHAPTER2_FIG01b}
    }%
  \end{center}
  \caption{Histogram of nearest neighbors}
  \label{CHAPTER2_FIG01}
\end{figure}

Docendi eligendi sit et, pri ea dicam eligendi percipitur, has soleat 
dolores convenire te. Sed altera placerat an, id verterem abhorreant 
interesset mea. Eum at ceteros efficiantur. Eos id voluptaria efficiendi 
comprehensam. 

In mel modo dicam vocibus, eruditi consectetuer vim no, cu quaestio 
instructior eum. Justo nostrud fuisset ea mea, eam an libris repudiandae 
vituperatoribus. Est choro corrumpit definitionem at. Vel sint adhuc vocibus 
ea, illud epicuri eos no. Sea simul officiis ea, et qui veri invidunt 
appellantur. Vix et eros ancillae pertinax.

Aliquip lobortis ei est, at error viris graeco sed. Vel te elitr detracto, 
modo graecis scripserit ex nec. Errem utamur viderer per no, eam ea eripuit 
referrentur. Pro te dicat disputando. 

\vspace{0.25in}
\begin{table}[hbt]
  \caption{A portrait table:
    first column represents the year in which the Nobel prize in
    physics was awarded; second column indicates the name of the
    scientist and the third column is the work for which the Nobel
    prize was awareded}
  \begin{center}
    \begin{tabular}{lll}
      \hline
      \multicolumn{1}{c}{\textbf{Year}} & 
      \multicolumn{1}{c}{\textbf{Scientist(s)}} &
      \multicolumn{1}{c}{\textbf{Nobel Work}}\\
      \hline
      1901 & W. C. R\"{o}ntgen & X-rays\\
      1902 & H. A. Lorentz & Influence of magnetism on radiation\\
           & P. Zeeman     & Influence of magnetism on radiation\\
      1903 & A. H. Becquerel & Spontaneous radioactivity\\
           & M. Curie        & Radiation phenomena discovered by Becquerel\\
           & P. Curie        & Radiation phenomena discovered by Becquerel\\
      1904 & J. W. Strutt & Argon\\
      1905 & P. E. A. von Lenard & Cathode rays\\
      1906 & J. J. Thomson & Electrical conductivity of gases\\
      1907 & A. A. Michelson & Spectroscopic and metrological investigations\\
      1908 & G. Lippmann & Photographic reproduction of colours\\
      1909 & K. F. Braun & Wireless telegraphy\\
           & G. Marconi &  Wireless telegraphy\\
      1910 & J. D. van der Waals & Equation of state of gases and liquids\\
      1911 & W. Wien & Laws governing heat radiation\\
      1912 & N. G. Dal\`{e}n & Automatic regulators for lighting coastal beacons\\
           &                 & and light buoys\\
      \hline
    \end{tabular}
    \label{CHAPTER2_TABLE01}
  \end{center}
\end{table}

As explained in Table \ref{CHAPTER2_TABLE01},
Ex offendit elaboraret cum has ex natum honestatis, impedit similique ex duo. 
Et mei mollis scripta, et vim labores phaedrum, in cum facete saperet. 
Splendide elaboraret comprehensam qui ne. Putant verterem no vim, mea solum 
veritus definitiones ei, no labitur propriae deseruisse est. Ius illud everti 
salutandi id, eu facer pericula principes est.

\begin{figure}[htb]
  \begin{center}
    \begin{tikzpicture}[
      thick,
      >=stealth',
      dot/.style = {
        draw,
        fill = white,
        circle,
        inner sep = 0pt,
        minimum size = 4pt
      }
      ]
      \coordinate (O) at (0,0);
      \draw[->] (-0.3,0) -- (8,0) coordinate[label = {below:$x$}] (xmax);
      \draw[->] (0,-0.3) -- (0,5) coordinate[label = {right:$f(x)$}] (ymax);
      \path[name path=x] (0.3,0.5) -- (6.7,4.7);
      \path[name path=y] plot[smooth] coordinates {(-0.3,2) (2,1.5) (4,2.8) (6,5)};
      \scope[name intersections = {of = x and y, name = i}]
        \fill[gray!20] (i-1) -- (i-2 |- i-1) -- (i-2) -- cycle;
        \draw (0.3,0.5) -- (6.7,4.7) node[pos=0.8, below right] {secant};
        \draw[red] plot[smooth] coordinates {(-0.3,2) (2,1.5) (4,2.8) (6,5)};
        \draw (i-1) node[dot, label = {above:$P$}] (i-1) {} -- node[left]
          {$f(x_0)$} (i-1 |- O) node[dot, label = {below:$x_0$}] {};
        \path (i-2) node[dot, label = {above:$Q$}] (i-2) {} -- (i-2 |- i-1)
          node[dot] (i-12) {};
        \draw (i-12) -- (i-12 |- O) node[dot,
          label = {below:$x_0 + \varepsilon$}] {};
        \draw[blue, <->] (i-2) -- node[right] {$f(x_0 + \varepsilon) - f(x_0)$}
          (i-12);
        \draw[blue, <->] (i-1) -- node[below] {$\varepsilon$} (i-12);
        \path (i-1 |- O) -- node[below] {$\varepsilon$} (i-2 |- O);
        \draw[gray] (i-2) -- (i-2 -| xmax);
        \draw[gray, <->] ([xshift = -0.5cm]i-2 -| xmax) -- node[fill = white]
          {$f(x_0 + \varepsilon)$}  ([xshift = -0.5cm]xmax);
      \endscope
    \end{tikzpicture}
  \end{center}
  \caption{Fancy mathematical plots using TikZ package}
  \label{CHAPTER2_FIG02}
\end{figure}

Simul noster voluptaria eam ei, sint regione pri ei. Cum no utinam equidem, 
falli bonorum prodesset an qui. Alterum dissentiet vituperatoribus te eam, 
eos ea suas oblique. Per ea utinam facilisi. Per iudico probatus complectitur 
et, cum tollit atomorum rationibus ea.

Docendi eligendi sit et, pri ea dicam eligendi percipitur, has soleat 
dolores convenire te. Sed altera placerat an, id verterem abhorreant 
interesset mea. Eum at ceteros efficiantur. Eos id voluptaria efficiendi 
comprehensam.

Simul noster voluptaria eam ei, sint regione pri ei. Cum no utinam equidem, 
falli bonorum prodesset an qui. Alterum dissentiet vituperatoribus te eam, 
eos ea suas oblique. Per ea utinam facilisi. Per iudico probatus complectitur 
et, cum tollit atomorum rationibus ea.

\begin{figure}[htb]
  \begin{center}
    \begin{tikzpicture}[
      scale=1.5,
      media/.style={font={\footnotesize\sffamily}},
      wave/.style={
        decorate,decoration={snake,post length=1.4mm,amplitude=2mm,
        segment length=2mm},thick},
      interface/.style={
        % The border decoration is a path replacing decorator.
        % For the interface style we want to draw the original path.
        % The postaction option is therefore used to ensure that the
        % border decoration is drawn *after* the original path.
        postaction={draw,decorate,decoration={border,angle=-45,
                    amplitude=0.3cm,segment length=2mm}}},
      ]
      % Round rectangle
      \fill[gray!10,rounded corners] (-4,-3) rectangle (4,0);
      % Interface
      \draw[blue,line width=.5pt,interface](-4,0)--(4,0);
      % Vertical dashed line
      \draw[dashed,gray](0,-3)--(0,3);
      % Coordinates system
      \draw(0,0.15)node[above]{$x$};
      \draw[<->,line width=1pt] (1,0) node[above]{$y$}-|(0,-1) node[left]{$z$};
      % Incidence
      \draw[->,wave]
        (135:3.2cm)--(135:2.5cm)node[right]{$f^0$};
      \draw[gray](0:0cm)--(135:2cm);
      \path (0,0)++(113:1cm)node{$\phi$};
      \draw[->](0,0.75)arc(90:135:.75cm);
      % Transmission
      \draw[->,wave]
        (-30:2.5cm)--(-30:3.2cm)node[right]{$f^+$};
      \draw[gray](0:0cm)--(-30:2cm);
      \path (0,0)++(-60:1cm)node{$\theta$};
      \draw[->] (0,-0.75) arc (-90:-30:.75cm);
      % Reflection
      \draw[->,wave]
        (45:2.5cm)--(45:3.2cm)node[right]{$f^-$};
      \path (0,0)++(-22:1.75cm) node{$\psi$};
      \draw[gray](0:0cm)--(45:2cm);
      \draw[->] (0,-1.5)arc(-90:45:1.5cm);
      % Media names
      \path[media] (-3,.6)  node {media 1}
                   (-3,-.6) node {media 2};
      % $x$ axis
      \filldraw[fill=white,line width=1pt](0,0)circle(.12cm);
      \draw[line width=.6pt] (0,0)
        +(-135:.12cm) -- +(45:.12cm)
        +(-45:.12cm) -- +(135:.12cm);
      % Interface pointer
      \draw[-latex,thick](3.2,0.5)node[right]{$\mathsf{S_{1,2}}$}
        to[out=180,in=90] (3,0);
      % To-paths are really useful for drawing curved lines. The above
      % to path is equal to:
      %
      % \draw[-latex,thick](3.2,0.5)node[right]{$\mathsf{S_{1,2}}$}
      %      ..controls +(180:.2cm) and +(up:0.25cm) .. (3,0);
      % Internally the to path is translated to a similar bezier curve,
      % but the to path syntax hides the complexity from the user. 
    \end{tikzpicture}
  \end{center}
  \caption{Incidence, transmission and reflection}
  \label{CHAPTER2_FIG03}
\end{figure}

Docendi eligendi sit et, pri ea dicam eligendi percipitur, has soleat 
dolores convenire te. Sed altera placerat an, id verterem abhorreant 
interesset mea. Eum at ceteros efficiantur. Eos id voluptaria efficiendi 
comprehensam. Simul noster voluptaria eam ei, sint regione pri ei. Cum no 
utinam equidem, falli bonorum prodesset an qui. 
